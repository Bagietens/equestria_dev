==============================
==      PROJECT EXODUS      ==
== Refugees, Nomads and You ==
==      Happy's  Guide      ==
==============================

To view this documentation:
- I really recommend turning Word Wrap on - I've tried to do my best to keep things to new lines, but it can get a little messy in places.
- I'd also advise against opening this with a spellchecker active. I can't spell, especially in my usual caffeine-filled documentation craze. Don't judge me, just shout at me on the Discord instead.

== Introduction ==

Welcome to this wonderful piece of documentation for Old World Blues' "Project Exodus", an expansive background system focusing on modeling and portraying the movement of populations and destruction of military conflict. 

This piece of documentation originally comes straight from the equivalent in Old World Blues' files, but I've adapted it in places to match the Equestria at War files. If you have questions, ping me on the EaW Discord (so I know what we're talking about).

The system aims to take OWB's legacy 'decimation' system and:
(a) make the system more dynamic, allowing unique interactions between different kinds of nations
(b) augment the system to also account for the movement of civilian populations (refugees) at the same time
(c) continue to use the system as an effective break on significant snowballing, especially considering the relatively decreased factory density in OWB
(d) give players more control in the process, and more information as the model takes places

This documentation serves as both a planning/calculation document and an explanatory document. I intend to make the system as clear as possible for players, and so this document is primarily aimed at deciphering my thought processes and code for submodders and for myself, later down the line.

The system is deliberately crafted to be highly moddable and modifiable, without having to change the core code.
While this theoretically means the system is relatively transposable to other mods and vanilla, do not do this without both my permission and help: there are still some more stubborn pieces of code that rely on OWB-exclusive triggers/features.

== Overview ==

The system works in four main sections:
(1) Set-Up, done on gamestart
(2) Exodus Calculations, done when a state is transfered
(3) Reallocating Populations and Buildings, done immediately following (2) to close by states and regional centers
(4) Relaying the Changes, to tooltips and scripted shenanigans

Each of these four sections is a separate section in this documentation, to help you understand the system closely.
I recommend copious amounts of coffee before proceeding!

== Section 1: Set-Up ==

Project Exodus' core set-up occurs on gamestart, and is conducted in 'exodus_setup_on_actions.txt'

The part you're probably most interested in is tweaking core values. For simplicity, these are all defined at the very top of the document and are broadly explained below. Adjusting these is the easiest modification to the system you can make, without having to touch more of the detailed code.

== Section 2: Exodus Calculations ==

Effects are handled in on_actions/exodus_main_on_action.txt, but calculation itself happens in scripted_effects/exodus_effects.txt.
Section 2 and 3 are split into parts, to make the files more readable.

= 2.1: Core Variables =

In the scripted_effects file, all inputs are proceeded by an @ so that they work. The following list ignores that, but make sure you keep the @ when you edit the file. All core variables in the following list are further modifiable by national spirits and the like, allowing significant granularity between nations and games. If you're trying to modify specific interactions, I strongly advise using these modifiers, which are explained in depth later.

Oh, and NEVER SET VALUES TO 0. YOU WILL GET A DIVIDE BY 0 ERROR SOMEWHERE AND BE SAD.

Input Core Variables:
- core_refugee_base --> The core percentage of the population that will flee following a change in state control. This should be treated approximately as the percentage that would *ordinarily* flee in a 'standard' war. Obviously, this is somewhat modifier by other factors, but will on average tend towards this core.
- core_nomadicity --> The base nomadicity of nations, and reflects how mobile a population is as a whole. Such a number will depend wildly on your mod's exact circumstances and timeframe: in Fallout, it is much easier for families to uproot and move than it would be from 1939 Paris. Note the point of this variable is not to reflect how *far* a population could move, but instead their propensity to *make* a move.
- core_occupier_modifier --> The base appeal of states belonging to the new state controller is valued to refugees. Lower values mean far more refugees will flee, and is a broad proxy for nationalism/propaganda etc.
- core_has_core --> The increase in appeal that will be granted if the new owner has a core on the state.
- core_stability_divide --> The amount stability is divided by when weighting its impact.
- core_building_elasticity --> The base elasticity of buildings proportional to refugees. This many multiples of the final refugee percentage are moved/destroyed by the system.

Weighting Core Variables:
- core_appeal --> The base appeal states have to fleeing refugees. Appeal is relative, so the base number doesn't matter especially, but increasing it significantly makes the effect of discrepancies more obvious, so can be used as a proxy for how clustered refugees should be rather than tweaking individual factors.
- core_distance_divisor --> The value all distance values are divided by. Higher values reduce the impact of distance on refugees.
- core_population_k_divisor --> The value all state populations (in thousands) are divided by. Higher values reduce the impact of local population on refugees (they tend towards more populous states).

= 2.2: Input Calculations =

= 2.3: Target Calculations =

= 2.4: Weighting Calculations =

In this set of calculations, every state identified as a target by the target calculations are given a local weight, assigned as a variable in the relevant state's scope. The proportion of this local weight to the total weight of every state affected then determines the share of refugees and buildings each target state recieves.

Unlike factors affecting input, weighting factors (and the corrosponding modifier) are multiplicative. This means values need to be set even more carefully, as 'positive' factors must have a core value greater than 1 while negative factors must have a core value less than 1. 'Scaling' these values too highly will also drastically increase/decrease the relative importance of the factors, so be cautious when adjusting these.

The approximate formula for each state's weight is:

LOCAL WEIGHT = (BASE * APPEAL) / DISTANCE

Where distance has been modified by the distance_divisor, and appeal is the amalgamation of the multiplicative factors (x*y*z = appeal).

The state's local weight is then added to the total weighting of all states so that a fraction can be determined in the reallocation phase.

== Section 3: Reallocating Populations and Buildings ==

= 3.1: Core Variables =

Building Allocation Core Variables:
- core_destruction_divisor --> The percentage of total buildings affected that are destroyed. This is a broad proxy for how easy buildings are to move, and higher values represent more static buildings (e.g. modern arms factories). Lower values, meanwhile, help more actively prevent snowballing by strengthening the neighbors of defeated nations, and is a useful balancing mechanic.

== Section 4: Modifiers and You ==